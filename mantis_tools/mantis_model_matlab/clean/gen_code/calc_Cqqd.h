#include <eigen3/Eigen/Dense>

inline void calc_Cqqd(Eigen::MatrixXd& Cqqd, double IJ1x, double IJ1y, double IJ2x, double IJ2y, double bvx, double bvy, double bvz, double bw1, double bw2, double bw3, double l0, double l1, double l2, double m1, double m2, double r1, double r1d, double r2, double r2d) {
	Cqqd(4,0) = r1d*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0))+l2*m2*r2d*sin(r1+r2)*(1.0/4.0);
	Cqqd(6,0) = -bvy*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0));
	Cqqd(7,0) = bvy*l2*m2*sin(r1+r2)*(-1.0/4.0);
	Cqqd(3,1) = -r1d*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0))-l2*m2*r2d*sin(r1+r2)*(1.0/4.0);
	Cqqd(5,1) = r1d*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))+l2*m2*r2d*cos(r1+r2)*(1.0/4.0);
	Cqqd(6,1) = -bvz*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))+bvx*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0));
	Cqqd(7,1) = bvz*l2*m2*cos(r1+r2)*(-1.0/4.0)+bvx*l2*m2*sin(r1+r2)*(1.0/4.0);
	Cqqd(4,2) = -r1d*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0))-l2*m2*r2d*cos(r1+r2)*(1.0/4.0);
	Cqqd(6,2) = bvy*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0));
	Cqqd(7,2) = bvy*l2*m2*cos(r1+r2)*(1.0/4.0);
	Cqqd(1,3) = -r1d*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0))-l2*m2*r2d*sin(r1+r2)*(1.0/4.0);
	Cqqd(3,3) = r1d*(IJ2x*cos(r1+r2)*sin(r1+r2)-IJ2y*cos(r1+r2)*sin(r1+r2)+IJ1x*cos(r1)*sin(r1)-IJ1y*cos(r1)*sin(r1)-m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))+l1*m1*sin(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/2.0))-r2d*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*sin(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0));
	Cqqd(5,3) = -r1d*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0))-r2d*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0));
	Cqqd(6,3) = -bvx*(IJ2x*cos(r1+r2)*sin(r1+r2)-IJ2y*cos(r1+r2)*sin(r1+r2)+IJ1x*cos(r1)*sin(r1)-IJ1y*cos(r1)*sin(r1)-m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))+l1*m1*sin(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/2.0))+bvz*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0))+bw2*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0));
	Cqqd(7,3) = bvx*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*sin(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0))+bvz*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0))+bw2*l2*m2*sin(r1+r2)*(1.0/4.0);
	Cqqd(0,4) = r1d*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0))+l2*m2*r2d*sin(r1+r2)*(1.0/4.0);
	Cqqd(2,4) = -r1d*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0))-l2*m2*r2d*cos(r1+r2)*(1.0/4.0);
	Cqqd(4,4) = r2d*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)-l1*l2*m2*sin(r2)*(1.0/2.0))+r1d*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)+l0*l1*m1*sin(r1)*(1.0/2.0)+l0*l1*m2*sin(r1));
	Cqqd(6,4) = bw3*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0))-bw1*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0))-bvy*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)+l0*l1*m1*sin(r1)*(1.0/2.0)+l0*l1*m2*sin(r1))+l1*l2*m2*r2d*sin(r2)*(1.0/2.0);
	Cqqd(7,4) = -bvy*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)-l1*l2*m2*sin(r2)*(1.0/2.0))+bw3*l2*m2*cos(r1+r2)*(1.0/4.0)-bw1*l2*m2*sin(r1+r2)*(1.0/4.0)-l1*l2*m2*r1d*sin(r2)*(1.0/2.0);
	Cqqd(1,5) = r1d*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))+l2*m2*r2d*cos(r1+r2)*(1.0/4.0);
	Cqqd(3,5) = -r1d*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0))-r2d*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0));
	Cqqd(5,5) = r1d*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)-IJ1x*cos(r1)*sin(r1)+IJ1y*cos(r1)*sin(r1)+m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))+(l1*l1)*m1*cos(r1)*sin(r1)*(1.0/4.0))+r2d*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*cos(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0));
	Cqqd(6,5) = -bvz*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)-IJ1x*cos(r1)*sin(r1)+IJ1y*cos(r1)*sin(r1)+m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))+(l1*l1)*m1*cos(r1)*sin(r1)*(1.0/4.0))-bw2*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))+bvx*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0));
	Cqqd(7,5) = -bvz*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*cos(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0))+bvx*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0))-bw2*l2*m2*cos(r1+r2)*(1.0/4.0);
	Cqqd(0,6) = bvy*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0))-r1d*(l1*m1*sin(r1)*(1.0/2.0)+l1*m2*sin(r1)+l2*m2*sin(r1+r2)*(1.0/2.0))-l2*m2*r2d*sin(r1+r2)*(1.0/2.0);
	Cqqd(1,6) = bvz*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))-bvx*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0));
	Cqqd(2,6) = -bvy*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0))+r1d*(l1*m1*cos(r1)*(1.0/2.0)+l1*m2*cos(r1)+l2*m2*cos(r1+r2)*(1.0/2.0))+l2*m2*r2d*cos(r1+r2)*(1.0/2.0);
	Cqqd(3,6) = bvx*(IJ2x*cos(r1+r2)*sin(r1+r2)-IJ2y*cos(r1+r2)*sin(r1+r2)+IJ1x*cos(r1)*sin(r1)-IJ1y*cos(r1)*sin(r1)-m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))+l1*m1*sin(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/2.0))-bvz*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0))-bw2*(m2*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0)+l1*m1*sin(r1)*(1.0/4.0));
	Cqqd(4,6) = -r2d*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)-l1*l2*m2*sin(r2)*(1.0/2.0))-bw3*(l1*m1*cos(r1)*(1.0/4.0)+l1*m2*cos(r1)*(1.0/2.0)+l2*m2*cos(r1+r2)*(1.0/4.0))+bw1*(l1*m1*sin(r1)*(1.0/4.0)+l1*m2*sin(r1)*(1.0/2.0)+l2*m2*sin(r1+r2)*(1.0/4.0))+bvy*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)+l0*l1*m1*sin(r1)*(1.0/2.0)+l0*l1*m2*sin(r1))-r1d*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)+l0*l1*m1*sin(r1)*(1.0/2.0)+l0*l1*m2*sin(r1));
	Cqqd(5,6) = bvz*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)-IJ1x*cos(r1)*sin(r1)+IJ1y*cos(r1)*sin(r1)+m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))+(l1*l1)*m1*cos(r1)*sin(r1)*(1.0/4.0))+bw2*(m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+l1*m1*cos(r1)*(1.0/4.0))-bvx*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)+m2*pow(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1),2.0)*(1.0/2.0)+IJ1x*cos(r1*2.0)*(1.0/2.0)-IJ1y*cos(r1*2.0)*(1.0/2.0)-m2*(l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0)+(l1*l1)*m1*pow(sin(r1),2.0)*(1.0/8.0)+l1*m1*cos(r1)*(l0-l1*cos(r1)*(1.0/2.0))*(1.0/4.0));
	Cqqd(6,6) = l1*l2*m2*r2d*sin(r2)*(-1.0/2.0);
	Cqqd(7,6) = bvy*l1*l2*m2*sin(r2)*(-1.0/2.0)+l1*l2*m2*r1d*sin(r2)*(1.0/2.0);
	Cqqd(0,7) = bvy*l2*m2*sin(r1+r2)*(1.0/4.0)-l2*m2*r1d*sin(r1+r2)*(1.0/2.0)-l2*m2*r2d*sin(r1+r2)*(1.0/2.0);
	Cqqd(1,7) = bvz*l2*m2*cos(r1+r2)*(1.0/4.0)-bvx*l2*m2*sin(r1+r2)*(1.0/4.0);
	Cqqd(2,7) = bvy*l2*m2*cos(r1+r2)*(-1.0/4.0)+l2*m2*r1d*cos(r1+r2)*(1.0/2.0)+l2*m2*r2d*cos(r1+r2)*(1.0/2.0);
	Cqqd(3,7) = -bvx*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*sin(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/2.0))-bvz*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0))-bw2*l2*m2*sin(r1+r2)*(1.0/4.0);
	Cqqd(4,7) = bvy*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)-l1*l2*m2*sin(r2)*(1.0/2.0))-r1d*(l0*l2*m2*sin(r1+r2)*(1.0/2.0)-l1*l2*m2*sin(r2)*(1.0/2.0))-l2*m2*r2d*(l0*sin(r1+r2)-l1*sin(r2))*(1.0/2.0)-bw3*l2*m2*cos(r1+r2)*(1.0/4.0)+bw1*l2*m2*sin(r1+r2)*(1.0/4.0);
	Cqqd(5,7) = bvz*(-IJ2x*cos(r1+r2)*sin(r1+r2)+IJ2y*cos(r1+r2)*sin(r1+r2)+l2*m2*cos(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/2.0))-bvx*(IJ2x*cos(r1*2.0+r2*2.0)*(1.0/2.0)-IJ2y*cos(r1*2.0+r2*2.0)*(1.0/2.0)-l2*m2*cos(r1+r2)*(-l0+l2*cos(r1+r2)*(1.0/2.0)+l1*cos(r1))*(1.0/4.0)+l2*m2*sin(r1+r2)*(l2*sin(r1+r2)*(1.0/2.0)+l1*sin(r1))*(1.0/4.0))+bw2*l2*m2*cos(r1+r2)*(1.0/4.0);
	Cqqd(6,7) = bvy*l1*l2*m2*sin(r2)*(1.0/2.0)-l1*l2*m2*r1d*sin(r2)*(1.0/2.0)-l1*l2*m2*r2d*sin(r2)*(1.0/2.0);
}
